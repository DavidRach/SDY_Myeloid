---
title: "openCyto protocol"
format: html
---

Goal is to take the newly copied files from the external hard drive folder, verify whether they have been already visualized. If not, proceed to create a GatingSet with specification by condition. From there, generate Unity plots, RidgePlots, and NxN plots for initial evaluation of unmixing quality for the respective major cell populations, flagging areas of concern for Luciernaga informed secondary unmixing. 

# Getting Started
```{r}
#| message: FALSE
#| warning: FALSE

library(HEULog)
library(Luciernaga)
library(dplyr)
library(purrr)
library(flowWorkspace)
library(openCyto)
library(flowCore)
```

```{r}
Location <- file.path("/home", "david", "Desktop", "Luciernaga_Checks")
FCSFiles <- list.files(Location, pattern=".fcs", full.names=TRUE, recursive=FALSE)
Samples <- FCSFiles[stringr::str_detect(FCSFiles, "NoTags")] #OneTagUV7 #OneTagV7 #TwoTag
```

```{r}
ExperimentsPresent <- sub("-.*", "", basename(Samples)) |> unique()
```

```{r}
#| eval: FALSE

# Setup for data folder and ProcessedExperiments.csv
IsDataPresent <- list.files(include.dirs=TRUE)
if (!any(IsDataPresent %in% "data")){dir.create("data")}
CSVFiles <- list.files("data", pattern="ProcessedExperiments.csv")

if (length(CSVFiles) == 0){
    ProcessedExperiments <- data.frame(Experiment="Test", Date="2000-01-01")
    filename <- "ProcessedExperiments.csv"
    StorageLocation <- file.path("data", filename)
    write.csv(ProcessedExperiments, StorageLocation, row.names=FALSE)
}
```

```{r}
CSV <- "data/ProcessedExperiments.csv"
Data <- read.csv(CSV, check.names=FALSE)
AlreadyVisualized <- Data |> pull(Experiment)

This <- "2025-08-06"

walk(.f=ExperimentVisualized, .x=This, visualized=AlreadyVisualized, files=Samples, conditions=c("Exp6"), template="GatesUnmixed.csv", UnityY="BV570-A", UnityX="BV650-A", GatePlots=FALSE, RidgePlots=FALSE, UnityPlots=TRUE, OneByNPlots=FALSE, Docker=FALSE, Override=TRUE, nameOverride=TRUE, marginsubset="nonDebris", mainsubset="monocytes",
AllUnity=c("BUV395-A", "BUV563-A", "BUV615-A", "BUV661-A", "BUV737-A", "BUV805-A", "BV570-A", "BV605-A", "BV650-A", "BV711-A", "BV750-A", "BV785-A",
"FITC-A", "Spark Blue 550-A", "RB613-A", "PerCP-Cy5.5-A", "PE-A",
"PE-Dazzle594-A", "PE-Cy5-A", "cFluor BYG750-A", "PE-Cy7-A", "PE-Fire810-A",
"Alexa Fluor 647-A", "R718-A", "APC-Fire 750-A", "APC-Fire 810-A"), bins=170)
```

```{r}
print("Goodbye")
```
